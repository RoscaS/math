<!DOCTYPE html>
<html>

    <head>
        <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/py/py-OOP5.html">
  <link rel="alternate" type="application/rss+xml" title="RoscaS" href="http://localhost:4000/feed.xml">

<!-- JS -->
  <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> -->
  <script src="/js/mermaid.min.js"></script>

</head>


        
          <script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
  ga('create', 'UA-99742998-1', 'auto');
  ga('send', 'pageview');
    
	</script>


        

        
    </head>

    <body>
        <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Py: OOP 5 Héritage multiple, composition, délégation</title>
  <meta name="description" content="serie">
</head>


        <div class="wrapper">
            <header class="post-header">
	
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script
  type="text/javascript"
  charset="utf-8"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
>
</script>
<script
  type="text/javascript"
  charset="utf-8"
  src="https://vincenttam.github.io/javascripts/MathJaxLocal.js"
>
</script>


    <center>
		<div class="post-title" itemprop="name headline">Py: OOP 5 Héritage multiple, composition, délégation</div>

		<div class="post-meta"><i class="fa fa-calendar-o"></i> <time datetime="29 Jul 2017" itemprop="datePublished">Jul 29 2017</time>

			&nbsp;&nbsp;•&nbsp;&nbsp;<i class="fa fa-user-secret"></i> <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sol</span>
        	
			<br>
			<i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-pulse"></i></span>clicks</span>
		</div>

        	
        <div class="post-tags">
        	
			<a class="post-tags-item" href="http://localhost:4000/tags/">divers,</a>
        	
			<a class="post-tags-item" href="http://localhost:4000/tags/">fr,</a>
        	
			<a class="post-tags-item" href="http://localhost:4000/tags/">en</a>
        	
			
		</div>
    </center>

<div class="wrapper">

    <center>      
		<p>
			<a class="link" href="/">Home</a> /
			<a class="link" href="/archive/">Archive</a> /
			<a class="link" href="/category/">Category</a> / 
			<a class="link" href="/tags/">Tags</a> / 
			<a class="link" href="/about/">About</a> /
			<a class="link" href="/contact/">Contact</a>
    	</p>
    </center>
</div>
    
</header>

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<div class="post-content">
    <center>
	
	<p>Programmation orienté objet</p>
	
    </center>
	<h2>Directory</h2>
</div>

<div id="category"></div>

<div class="post-content" itemprop="articleBody">
    <h4 id="serie">serie</h4>

<ul>
  <li><a href="/py/py-OOP1.html">partie 1: Introduction </a></li>
  <li><a href="/py/py-OOP2.html">partie 2: En pratique</a></li>
  <li><a href="/py/py-OOP3.html">partie 3: Attributs</a></li>
  <li><a href="/py/py-OOP4.html">partie 4: Héritage</a></li>
  <li><a href="/py/py-OOP5.html">partie 5: Héritage multiple et composition</a>$ \Leftarrow $</li>
  <li><a href="/py/py-OOP6.html">partie 6: Méthodes magiques</a></li>
</ul>

<h4 id="sources">sources</h4>
<ul>
  <li><a href="http://sametmax.com/le-guide-ultime-et-definitif-sur-la-programmation-orientee-objet-en-python-a-lusage-des-debutants-qui-sont-rassures-par-les-textes-detailles-qui-prennent-le-temps-de-tout-expliquer-partie-1/">sam&amp;max</a></li>
</ul>

<h1 id="héritage-multiple">Héritage multiple</h1>

<p>Dans un jeux vidéo, nous avons des protections et des armes pour les personnages:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Arme</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">degat</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nom</span>   <span class="o">=</span> <span class="n">nom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degat</span> <span class="o">=</span> <span class="n">degat</span>
    
    <span class="k">def</span> <span class="nf">attaque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cible</span><span class="p">):</span>
        <span class="n">cible</span><span class="o">.</span><span class="n">vie</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degat</span>

<span class="k">class</span> <span class="nc">Protection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">armure</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nom</span>    <span class="o">=</span> <span class="n">nom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">armure</span> <span class="o">=</span> <span class="n">armure</span>
    
    <span class="k">def</span> <span class="nf">defend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degat</span><span class="p">):</span> <span class="c"># mitige dégats</span>
        <span class="n">degat</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armure</span>
        <span class="k">if</span> <span class="n">degat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">degat</span>

<span class="n">epee</span>   <span class="o">=</span> <span class="n">Arme</span><span class="p">(</span><span class="s">'Epée de ouf'</span><span class="p">,</span> <span class="n">degat</span> <span class="o">=</span> <span class="mi">999</span><span class="p">)</span>
<span class="n">casque</span> <span class="o">=</span> <span class="n">Protection</span><span class="p">(</span><span class="s">'Casque stylé'</span><span class="p">,</span> <span class="n">armure</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>

<p>La concurence est rude et on est à la traine. Il faut implémenter un barbar dans le jeu qui puisse taper avec son bouclier.</p>

<p>Une solution serait de créer une nouvelle classe qui hérite des deux classes en même temps:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ProtectionOffensive</span><span class="p">(</span><span class="n">Arme</span><span class="p">,</span> <span class="n">Protection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">degat</span><span class="p">,</span> <span class="n">armure</span><span class="p">):</span>
        <span class="n">Arme</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">degat</span><span class="p">)</span>        <span class="c"># appel __init__ Arme</span>
        <span class="n">Protection</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">armure</span><span class="p">)</span> <span class="c"># appel __init__ Protection</span>
</code></pre>
</div>

<p>Comme on a appelé les deux <code class="highlighter-rouge">__init__</code>, on va avoir les attributs settés dans les deux <code class="highlighter-rouge">__init__</code> attachés à cette classe.</p>

<p>Nous avons donc une classe qui possède les méthodes des deux classes parentes:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span><span class="n">bouclier</span> <span class="o">=</span> <span class="n">ProtectionOffensive</span><span class="p">(</span><span class="s">'Bouclier en taule'</span><span class="p">,</span> <span class="n">degat</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">armure</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span><span class="k">print</span><span class="p">(</span><span class="s">"degats bouclier:"</span><span class="p">,</span><span class="n">bouclier</span><span class="o">.</span><span class="n">degat</span><span class="p">)</span>
<span class="n">degats</span> <span class="n">bouclier</span><span class="p">:</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span><span class="k">print</span><span class="p">(</span><span class="s">"armure bouclier:"</span><span class="p">,</span><span class="n">bouclier</span><span class="o">.</span><span class="n">armure</span><span class="p">)</span>
<span class="n">armure</span> <span class="n">bouclier</span><span class="p">:</span> <span class="mi">100</span>
<span class="o">&gt;&gt;&gt;</span><span class="k">print</span><span class="p">(</span><span class="s">"bouclier.defend(214), degats restants:"</span><span class="p">,</span><span class="n">bouclier</span><span class="o">.</span><span class="n">defend</span><span class="p">(</span><span class="mi">214</span><span class="p">))</span>
<span class="n">bouclier</span><span class="o">.</span><span class="n">defend</span><span class="p">(</span><span class="mi">214</span><span class="p">),</span> <span class="n">degats</span> <span class="n">restants</span><span class="p">:</span> <span class="mi">114</span>
</code></pre>
</div>

<p>Les deux classes parentes ont une méthode <code class="highlighter-rouge">__init__</code> mais <strong>Python ne peut en “copier” qu’une seule</strong> dans l’enfant. Il copie donc la première qu’il trouve. Il va prendre la liste des parents (class C<strong>(A, B)</strong>:) et la lire de gauche à droite. Il va regarder chaque parent, et si la méthode <code class="highlighter-rouge">__init__</code> existe la <strong>“</strong>copier<strong>“</strong> dans l’enfant. Si il retrouve une méthode de même nom dans un des parents suivant, <strong>il l’ignore</strong>.</p>

<p>Dans notre exemple, si on fait:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ProtectionOffensive</span><span class="p">(</span><span class="n">Arme</span><span class="p">,</span> <span class="n">Protection</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">ProtectionOffensive</code> n’aura que la méthode <code class="highlighter-rouge">__init__</code> de <code class="highlighter-rouge">Arme</code> <strong>et ce n’est pas ce qu’on veut</strong>. On va donc override la méthode <code class="highlighter-rouge">__init__</code> de <code class="highlighter-rouge">ProtectionOffensive</code>, et dedans appeler la méthode <code class="highlighter-rouge">__init__</code> de <code class="highlighter-rouge">Arme</code> <strong>et</strong> de <code class="highlighter-rouge">Protection</code>.</p>

<p>Cette syntaxe: <code class="highlighter-rouge">Classe.methode(self, args...)</code> que l’on retrouve dans <code class="highlighter-rouge">Arme.__init__(self, nom, degat)</code> est juste un moyen d’<strong>appeler spécifiquement la méthode du parent</strong>.</p>

<p>Dans la partie précédente nous avons vu qu’on pouvait faire cela avec <code class="highlighter-rouge">super()</code>. Mais <code class="highlighter-rouge">super()</code> <strong>nous retournera la première méthode du premier parent qu’elle trouve</strong>. C’est le but de <code class="highlighter-rouge">super()</code>, de faire ça automatiquement sans se soucier de savoir qui est le premier parent à avoir une méthode du bon nom.</p>

<p>rappel syntaxe <code class="highlighter-rouge">super()</code>:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Enfant</span><span class="p">(</span><span class="n">Parent</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">calcule_complique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">liste</span><span class="p">,</span> <span class="n">ristourne</span><span class="p">):</span>
        <span class="n">prix</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">calcule_complique</span><span class="p">(</span><span class="n">liste</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prix</span> <span class="o">-</span> <span class="p">(</span><span class="n">prix</span> <span class="o">*</span> <span class="n">ristourne</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</code></pre>
</div>

<p>C’est utile car parfois c’est le parent du parent du parent qui a la méthode qu’on veut appeler, on ne connaît pas forcément son nom, ou alors on ne veut pas l’hard coder. Dans notre cas, on veut spécifiquement une méthode d’un parent en particulier, il faut donc l’écrire à la main.</p>

<p>De façon générale:</p>

<ul>
  <li>On utilise <code class="highlighter-rouge">super()</code> quand on fait de l’héritage simple où qu’on veut juste appeler la méthode du premier parent venu sans se soucier de son nom (car il peut être très haut dans la chaîne d’héritage).</li>
  <li>On utilise <code class="highlighter-rouge">Classe.methode(self, args...)</code> quand on veut spécifiquement appeler la méthode d’un parent en particulier.</li>
</ul>

<p><span style="color:red"> <strong>ATTENTION</strong> </span></p>

<p>Le <code class="highlighter-rouge">self</code> n’est pas au même endroit dans les cas suivants:</p>

<ul>
  <li><code class="highlighter-rouge">super().methode(args...)</code> $ \Rightarrow $ On passe la classe courante (que <code class="highlighter-rouge">super()</code> va analyser pour trouver les parents automatiquement)</li>
  <li><code class="highlighter-rouge">ClasseParente.methode(self, args...)</code> $ \Rightarrow $ On hard code le nom de la classe parente.</li>
</ul>

<h2 id="exemple-récapitulatif">Exemple récapitulatif</h2>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val_a</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>  <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_a</span> <span class="o">=</span> <span class="n">val_a</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">methodA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">"name: {}</span><span class="se">\t</span><span class="s">val_a: {}"</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_a</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">methodForE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">E don't know that A exist..."</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val_b</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>  <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_b</span> <span class="o">=</span> <span class="n">val_b</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">methodB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">"name: {}</span><span class="se">\t</span><span class="s">val_b: {}"</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_b</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">val_a</span><span class="p">,</span> <span class="n">val_b</span><span class="p">):</span>
        <span class="n">A</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">val_a</span><span class="p">)</span>
        <span class="n">B</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">val_b</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">methodC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">"name: {}</span><span class="se">\t</span><span class="s">val_a: {}</span><span class="se">\t</span><span class="s">val_b: {}"</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_b</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">E</span><span class="p">(</span><span class="n">D</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">methodForE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">methodForE</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">"{}</span><span class="se">\n</span><span class="s">...but still can override a method from it."</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">first</span><span class="p">))</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">objectA</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="s">"objectA"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">)</span>
<span class="n">objectB</span> <span class="o">=</span> <span class="n">B</span><span class="p">(</span><span class="s">"objectB"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">)</span>
<span class="n">objectC</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="s">"objectC"</span><span class="p">,</span> <span class="s">"a(C)"</span><span class="p">,</span> <span class="s">"b(C)"</span><span class="p">)</span>
<span class="n">objectD</span> <span class="o">=</span> <span class="n">D</span><span class="p">(</span><span class="s">"objectD"</span><span class="p">,</span> <span class="s">"a(D)"</span><span class="p">,</span> <span class="s">"b(D)"</span><span class="p">)</span>
<span class="n">objectE</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="s">"objectE"</span><span class="p">,</span> <span class="s">"a(E)"</span><span class="p">,</span> <span class="s">"b(E)"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">objectA</span><span class="o">.</span><span class="n">methodA</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectB</span><span class="o">.</span><span class="n">methodB</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectC</span><span class="o">.</span><span class="n">methodC</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">objectC also have acces to both methodA and methodB:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectC</span><span class="o">.</span><span class="n">methodA</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectC</span><span class="o">.</span><span class="n">methodB</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>output</strong>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>name: objectA   val_a: a
name: objectB   val_b: b
name: objectC   val_a: a(C)     val_b: b(C)

objectC also have acces to both methodA and methodB:
name: objectC   val_a: a(C)
name: objectC   val_b: b(C)
</code></pre>
</div>

<hr />

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">objectD have acces to methodC:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectD</span><span class="o">.</span><span class="n">methodC</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">objectD also have acces to both methodA and methodB:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectD</span><span class="o">.</span><span class="n">methodA</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectD</span><span class="o">.</span><span class="n">methodB</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>output</strong>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>objectD have acces to methodC:
name: objectD   val_a: a(D)     val_b: b(D)

objectD also have acces to both methodA and methodB:
name: objectD   val_a: a(D)
name: objectD   val_b: b(D)
</code></pre>
</div>

<hr />

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">objectE have acces to methodC:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectE</span><span class="o">.</span><span class="n">methodC</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">objectE also have acces to both methodA and methodB:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectE</span><span class="o">.</span><span class="n">methodA</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">objectE</span><span class="o">.</span><span class="n">methodB</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">objectE</span><span class="o">.</span><span class="n">methodForE</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>output</strong>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>objectE have acces to methodC:
name: objectE   val_a: a(E)     val_b: b(E)

objectE also have acces to both methodA and methodB:
name: objectE   val_a: a(E)
name: objectE   val_b: b(E)

E don't know that A exist...
...but still can override a method from it.
</code></pre>
</div>

<h1 id="la-composition-ou">La composition ou…</h1>

<p>… comment faire interagire plusieurs objets entre eux.</p>

<p>Revenons à notre exemple de jeu vidéo et ajoutons une classe:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Heros</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">vie</span><span class="p">,</span> <span class="n">arme</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">protection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nom</span>        <span class="o">=</span> <span class="n">nom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vie</span>        <span class="o">=</span> <span class="n">vie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arme</span>       <span class="o">=</span> <span class="n">arme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protection</span> <span class="o">=</span> <span class="n">protection</span>

    <span class="k">def</span> <span class="nf">combattre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ennemi</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"{} attaque {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">,</span> <span class="n">ennemi</span><span class="o">.</span><span class="n">nom</span><span class="p">))</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arme</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">arme</span><span class="o">.</span><span class="n">attaque</span><span class="p">(</span><span class="n">ennemi</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">ennemi</span><span class="o">.</span><span class="n">vie</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">enemi</span><span class="o">.</span><span class="n">arme</span><span class="p">:</span>
                <span class="n">ennemi</span><span class="o">.</span><span class="n">arme</span><span class="o">.</span><span class="n">attaque</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vie</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vie</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Victoire de {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"{} est mort"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">))</span>
</code></pre>
</div>

<p>Notons que nous n’avons pas de méthode <code class="highlighter-rouge">attaque()</code> sur notre héros. <strong>Nous utilisons la méthode attaque d’un objet <code class="highlighter-rouge">Arme</code></strong> qui est un attribut de la classe <code class="highlighter-rouge">Heros</code>.</p>

<p>La composition c’est ça, un objet qui en fait est composé de plusieurs sous-objets. Dans notre cas, notre objet de type <code class="highlighter-rouge">Hero</code> est aussi composé d’une arme et d’une protection, qui sont ses attributs. Il peut ainsi utiliser le comportement de ces onjets pour faire le boulot à sa place: **c’est ce qu’on appelle la délégation.</p>

<p>Reprenons notre code des armes un peu adapté:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># On change le code de l'arme, si la cible a une protection</span>
<span class="c"># cela diminue les dégâts pris</span>
<span class="k">class</span> <span class="nc">Arme</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">degat</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nom</span>   <span class="o">=</span> <span class="n">nom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degat</span> <span class="o">=</span> <span class="n">degat</span>
    
    <span class="k">def</span> <span class="nf">attaque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cible</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cible</span><span class="o">.</span><span class="n">protection</span><span class="p">:</span>
            <span class="n">degat</span> <span class="o">=</span> <span class="n">cible</span><span class="o">.</span><span class="n">protection</span><span class="o">.</span><span class="n">defend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degat</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"{} - {} = {}"</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cible</span><span class="o">.</span><span class="n">vie</span><span class="p">,</span> <span class="n">degat</span><span class="p">,</span> <span class="n">cible</span><span class="o">.</span><span class="n">vie</span> <span class="o">-</span> <span class="n">degat</span><span class="p">))</span>
            <span class="n">cible</span><span class="o">.</span><span class="n">vie</span> <span class="o">-=</span> <span class="n">degat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"{} - {} = {}"</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cible</span><span class="o">.</span><span class="n">vie</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degat</span><span class="p">,</span> <span class="n">cible</span><span class="o">.</span><span class="n">vie</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">degat</span><span class="p">))</span>
            <span class="n">cible</span><span class="o">.</span><span class="n">vie</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degat</span>


<span class="c"># Le code de l'armure ne bouge pas</span>
<span class="k">class</span> <span class="nc">Protection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">armure</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nom</span> <span class="o">=</span> <span class="n">nom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">armure</span> <span class="o">=</span> <span class="n">armure</span>

    <span class="k">def</span> <span class="nf">defend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degat</span><span class="p">):</span>
        <span class="n">degat</span> <span class="o">=</span> <span class="n">degat</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">armure</span>
        <span class="k">if</span> <span class="n">degat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="n">degat</span>
</code></pre>
</div>

<p>Et maintenant créons deux héros, armons les et faisons-les combattre:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">gnark</span>            <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="s">"Gnark"</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">gnark</span><span class="o">.</span><span class="n">arme</span>       <span class="o">=</span> <span class="n">Arme</span><span class="p">(</span><span class="s">"Lame T-Rex"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">gnark</span><span class="o">.</span><span class="n">protection</span> <span class="o">=</span> <span class="n">Protection</span><span class="p">(</span><span class="s">"Plastron dur"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">kaco</span>            <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="s">"Kaco"</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">kaco</span><span class="o">.</span><span class="n">arme</span>       <span class="o">=</span> <span class="n">Arme</span><span class="p">(</span><span class="s">"fourchette"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kaco</span><span class="o">.</span><span class="n">protection</span> <span class="o">=</span> <span class="n">Protection</span><span class="p">(</span><span class="s">"Slip"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">kaco</span><span class="o">.</span><span class="n">combattre</span><span class="p">(</span><span class="n">gnark</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>output</strong>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kaco attaque Gnark!
2000 - 0 = 2000
50 - 9 = 41
2000 - 0 = 2000
41 - 9 = 32
2000 - 0 = 2000
32 - 9 = 23
2000 - 0 = 2000
23 - 9 = 14
2000 - 0 = 2000
14 - 9 = 5
2000 - 0 = 2000
5 - 9 = -4
Kaco est mort comme un noob.
</code></pre>
</div>

<h2 id="dans-le-détail">Dans le détail</h2>

<p>Analysons la méthode combattre:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># ...</span>

<span class="c"># Elle attend un ennemi en paramètrem donc un objet Hero</span>
<span class="c"># self est l'objet en cours, donc aussi un objet Hero</span>
<span class="k">def</span> <span class="nf">combattre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ennemi</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"{} attaque {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">,</span> <span class="n">ennemi</span><span class="o">.</span><span class="n">nom</span><span class="p">))</span>

    <span class="c"># Une boucle infinie. Cette boucle loop pour </span>
    <span class="c"># toujours si il n'y a pas d'attribut arme !</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

        <span class="c"># On donne le premier coup à la personne qui attaque</span>
        <span class="c"># (l'objet en cours). On vérifie qu'il a une arme. </span>
        <span class="c"># Si c'est le cas, on appelle la méthode de l'arme</span>
        <span class="c"># "attaque()", et on lui passe en paramètre l'ennemi.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arme</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arme</span><span class="o">.</span><span class="n">attaque</span><span class="p">(</span><span class="n">ennemi</span><span class="p">)</span>
        
        <span class="c"># Condition de sortie de la boucle sur</span>
        <span class="c"># la vie du héro qui pris le coup.</span>
        <span class="k">if</span> <span class="n">ennemi</span><span class="o">.</span><span class="n">vie</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        
        <span class="c"># Ensuite on fait pareil à l'envers pour donner une</span>
        <span class="c"># change à l'adversaire de répliquer: on vérifie que </span>
        <span class="c"># l'ennemi a une arme, et si c'est le cas, on applique</span>
        <span class="c"># la méthode "attaque()" de l'arme à l'objet en cours</span>
        <span class="k">if</span> <span class="n">ennemi</span><span class="o">.</span><span class="n">arme</span><span class="p">:</span>
            <span class="n">ennemi</span><span class="o">.</span><span class="n">arme</span><span class="o">.</span><span class="n">attaque</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="c"># Condition de sortie de la boucle sur</span>
        <span class="c"># la vie du héro qui a pris le coup.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vie</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        
    <span class="c"># Une fois sorti de la boucle, on vérifie le </span>
    <span class="c"># niveau de vie pour désigner le vainqueur.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vie</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Victoire de {}!"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"{} est mort!"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom</span><span class="p">))</span>

<span class="c"># ...</span>
</code></pre>
</div>

<p>Donc <code class="highlighter-rouge">combattre()</code> utilise un objet <code class="highlighter-rouge">Arme</code>, et appelle la méthode <code class="highlighter-rouge">attaque()</code> d’<code class="highlighter-rouge">Arme</code> sur un objet <code class="highlighter-rouge">Heros</code>:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># ...</span>

<span class="c"># self est l'objet en cours, donc l'arme.</span>
<span class="c"># cible est un objet de la classe Hero qu'on passe en paramètre.</span>
<span class="k">def</span> <span class="nf">attaque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cible</span><span class="p">):</span>

    <span class="c"># Si la cible (objet Hero) a un attribut protection, les dégâts</span>
    <span class="c"># retirés sont diminués (ce calcul est fait par la protection).</span>
    <span class="k">if</span> <span class="n">cible</span><span class="o">.</span><span class="n">protection</span><span class="p">:</span>
        <span class="n">cible</span><span class="o">.</span><span class="n">vie</span> <span class="o">-=</span> <span class="n">cible</span><span class="o">.</span><span class="n">protection</span><span class="o">.</span><span class="n">defend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degat</span><span class="p">)</span>
    
    <span class="c"># Sinon, on retire les dégâts à la vie de la cible (Hero) directement.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cible</span><span class="o">.</span><span class="n">vie</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">degat</span>

<span class="c"># ...</span>
</code></pre>
</div>

<p>La méthode attaquer utilise elle-même la méthode <code class="highlighter-rouge">defend()</code> de l’objet de type <code class="highlighter-rouge">Protection</code>:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># ...</span>

<span class="c"># self est l'objet en cours, donc protection.</span>
<span class="c"># degat est un simple int.</span>
<span class="k">def</span> <span class="nf">defend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degat</span><span class="p">):</span>

    <span class="c"># On retourne les degâts infligés, moins la protection</span>
    <span class="k">return</span> <span class="n">degat</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">armure</span>

<span class="c"># ...</span>
</code></pre>
</div>

<p>Il y a deux choses a bien comprendre ici:</p>

<ul>
  <li>
    <p>Il y a <strong>6 objets</strong>. Deux de type <code class="highlighter-rouge">Hero</code> qui possèdent chacun un objet de type <code class="highlighter-rouge">Arme</code> et un objet de type <code class="highlighter-rouge">Protection</code> <strong>en attributs</strong>.</p>
  </li>
  <li>
    <p>On se sert des méthodes des objets de type <code class="highlighter-rouge">Armes</code> pour attaquer. On passe les objets de type <code class="highlighter-rouge">Hero</code> en paramètre de ces méthodes. Les objets de type <code class="highlighter-rouge">Arme</code> se servent des objets de type <code class="highlighter-rouge">Protection</code> que porte les objets de type <code class="highlighter-rouge">Hero</code> pour calculer les dégats.</p>
  </li>
</ul>

<p><span style="color:red"><strong>Ce dernier point est le plus important et la clé de voute de la compréhension de la POO.</strong></span> On le reprend:</p>

<ol>
  <li>Les objets de type <code class="highlighter-rouge">Hero</code> ont une référence aux objets de type <code class="highlighter-rouge">Arme</code></li>
  <li>On passe une référence des objets de type <code class="highlighter-rouge">Hero</code> aux objets de type <code class="highlighter-rouge">Arme</code></li>
  <li>Les objets de type <code class="highlighter-rouge">Arme</code> retirent de la vie à ces objets de type <code class="highlighter-rouge">Hero</code> mais calculent avant les dégats en fonction des objets de type <code class="highlighter-rouge">Protection</code> que les objets de type <code class="highlighter-rouge">Hero</code> portent.</li>
</ol>

<p><span style="color:red"> Les objets ont tous des références les uns vers les autres. <strong>Ils se manipulent tous les uns les autres.</strong> </span> <br /></p>

<blockquote>
  <p>Cela fait bizarre car dans la vie une épée ne manipule pas un héros. On comprend facilement qu’un héros ait un attribut épée mais il est difficile de comprendre qu’une épée ait une méthode, et que le paramètre de cette méthode soit un héros.</p>
</blockquote>

<p>C’est un concepte purement informatique: <strong>La logique des dégâts est codée dans l’arme</strong>, pas dans le héros. L’avantage de cette architecture, c’est que si on change d’arme, on peut changer la logique des dégâts. Par exemple, on peut rajouter une arme empoisonnée:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ArmeEmpoisonee</span><span class="p">(</span><span class="n">Arme</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">degat</span><span class="p">,</span> <span class="n">poison</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">nom</span><span class="p">,</span> <span class="n">degat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poison</span> <span class="o">=</span> <span class="n">poison</span>
    
    <span class="k">def</span> <span class="nf">attaque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cible</span><span class="p">):</span>
        <span class="c"># degats de l'arme normale</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">attaque</span><span class="p">(</span><span class="n">cible</span><span class="p">)</span>
        <span class="c"># defats ajoutés du poison</span>
        <span class="n">cible</span><span class="o">.</span><span class="n">vie</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poison</span>
</code></pre>
</div>

<p>Le mécanisme pour faire des dégâts de cette arme est différent. Il suffit d’équiper un héros avec une instance de cette arme (en changeant l’attribut) pour que ce nouveau calcul de dégats soit pris en compte:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">kaco</span>             <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="s">"Kaco"</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">kaco</span><span class="o">.</span><span class="n">arme</span>        <span class="o">=</span> <span class="n">ArmeEmpoisonee</span><span class="p">(</span><span class="s">"Cheat"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kaco</span><span class="o">.</span><span class="n">protection</span>  <span class="o">=</span> <span class="n">Protection</span><span class="p">(</span><span class="s">"Slip"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">kaco</span><span class="o">.</span><span class="n">combattre</span><span class="p">(</span><span class="n">gnark</span><span class="p">)</span> <span class="c"># Vengeance !</span>
</code></pre>
</div>

<p><strong>output</strong>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kaco attaque Gnark!
2000 - 0 = 2000
Victoire de Kaco!
</code></pre>
</div>

<p>Ce qu’il faut retenir: On peut mettre des objets en tant qu’attributs d’autres objets. Il n’y a pas de limite dans le nombres d’objets, leur mélange, les niveau d’imbrication, etc… On peut mettre des objets, dans des objets, dans des objets,… <strong>C’est la composition</strong>.</p>

<p>Les objets peuvent utiliser les méthodes des autres objets. Et on peut passer des objets comme paramètres à des méthodes. <strong>C’est la délégation</strong>.</p>

<p>On peut biensur mettre des objets dans des sets, des dicos, des listes, … ps juste dans des attributs. Il y a un tas de chose à faire avec eux…</p>

<h1 id="choisir-entre-lhéritage-et-la-composition">Choisir entre l’héritage et la composition</h1>

<p>Les deux techniques permettent de réutiliser du code, mis pas de la même façon. Aucune règle générale ne tient la route dans tous les cas, mais un bon poinr de départ est de se dire que:</p>

<ul>
  <li>
    <p>Si nous avons deux objets de même nature, et qu’un est une spécialisation de lautre (Garçon est une spécialisation de Personne, Voiture une spécialisation de Véhicule, Clio une spécialisation de voiture,…) <strong>alors on préfèrera l’héritage</strong>.</p>
  </li>
  <li>
    <p>Si nous avons deux objets qui échangent des données, qui sont associés ou qui dans la vie réelle sont des “parts de” (Un article est une partie d’un blog, Un coeur est une partie d’un corp,…) <strong>alors on préfèrera la composition</strong>.</p>
  </li>
</ul>

<p><span style="color:red"> Ne pas oublier la différence entre <strong>aggrégation</strong> et <strong>composition</strong> vue en C++.</span> Mais on vivra très bien sans pour le moment.</p>

<h1 id="deign-pattern-stratégie">Deign pattern “stratégie”</h1>

<p>Le motif de conception (design pattern) “stratégie”, et une mise en application abstraite de la composition.</p>

<p>Normalement, la composition s’utilise avec des “part de” <strong>concrètes</strong>. Une voiture est composée d’objets pneus, d’un objet moteur, etc …</p>

<p>Le defign pattern stratégie est l’extraction d’un part du comportement d’un objet pour le mettre dans un autre objet. Mais la nature de l’objet importe peu. Ceci est fait purement pour découpler le comportement de l’objet.</p>

<p>On a vu plus haut que changer l’arme permet de changer le calcul des dégâts. C’est ce type de résultat qu’on vise avec le design pattern strategy.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>

<span class="k">class</span> <span class="nc">ParseurXml</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ParseurJson</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ParseurDeFichier</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_strategy</span> <span class="o">=</span> <span class="p">{</span>   <span class="c"># les stratégies par défaut</span>
        <span class="s">'json'</span><span class="p">:</span> <span class="n">ParseurXml</span><span class="p">,</span>
        <span class="s">'xml'</span> <span class="p">:</span> <span class="n">ParseurJson</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fichier</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fichier</span> <span class="o">=</span> <span class="n">fichier</span>

        <span class="c"># On récupère l'extension du fichier</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fichier</span><span class="p">)</span>

        <span class="c"># Strategy est une classe de parseur</span>
        <span class="c"># on la récupère depuis les paraètres </span>
        <span class="c"># ou selon l'extension.</span>
        <span class="n">Strategy</span> <span class="o">=</span> <span class="n">strategy</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strategy</span><span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">'.'</span><span class="p">)]</span>

        <span class="c"># On instancie notre classe de strategie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">Strategy</span><span class="p">(</span><span class="n">fichier</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># On délègue le boulot à la stratégie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
</code></pre>
</div>

<p>La ligne la plus importante est:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">Strategy</span> <span class="o">=</span> <span class="n">strategy</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strategy</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span>
</code></pre>
</div>

<p>Ici on dit récupère la stratégie de parsing en paramètre, ou si non, la bonne en fonction de l’extention du fichier. On charge donc une classe dynamiquement, on va créer un objet à partir de cette classe. Et c’est cet objet à qui on va déléguer le comportement du parseur:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
</code></pre>
</div>

<p>On utilise l’objet dynamiquement pour gérer tout le parsing. On peut ainsi choisir un parseur à la volée.</p>

<p>La pattern strategy mélange donc composition (l’objet strategy est une part de l’objet général), délégation (l’objet général utilise le comportement de l’objet strategy) et d’injection de dépendance (on peut changer l’algorithme à la volée, il suffit de changer de stratégie).</p>

<h1 id="suite">Suite</h1>

<ul>
  <li><a href="/py/py-OOP6.html">partie 6</a></li>
</ul>

</div>

<div>
	
	<div class="tbc"></div>
	
</div>

<!--<div class="share">
    <p>Share this post with: </p>
	<a href="https://twitter.com/intent/tweet?text=Py: OOP 5 Héritage multiple, composition, délégation@&amp;url=http://localhost:4000/py/py-OOP5.html" class="twitter-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
		</span>
	</a>
    
	<a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/py/py-OOP5.html" class="facebook-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
		</span>
	</a>
    
	<a href="https://plus.google.com/share?url=http://localhost:4000/py/py-OOP5.html" class="googleplus-share">
		<span class="fa-stack fa-lg">
			<i class="fa fa-circle fa-stack-2x"></i>
			<i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
		</span>
	</a>
</div>
-->

<div id="disqus_thread"></div>


 
</div>


</article>

        </div>

    </body>

<footer class="site-footer">
    <div class="wrapper">
        <center>
            <p>
                <a class="link" href="/%20/">Home</a> /
                <a class="link" href="/archive/">Archive</a> /
                <a class="link" href="/category/">Category</a> /
                <a class="link" href="/tags/">Tags</a> /
                <a class="link" href="/about/">About</a> /
                <a class="link" href="/contact/">Contact</a>
            </p>
            <span><script>document.write(new Date().getFullYear());</script></span>
            <span>&copy;</span>

            <a href="mailto:sol.rosca@gmail.com?subject=Hello&nbsp;RoscaS"> RoscaS</a>
            <br>
        </center>
    </div>
</footer>

<foot>
    <foot>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Derictory -->

  <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
  <script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>

<!-- Hit analytics -->

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- Directory -->

<script src="/js/main.js"></script>

</foot>

</foot>

</html>
